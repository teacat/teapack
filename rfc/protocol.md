## 格式

WebSocket 會以二進制的格式傳遞資料，但第一個開頭為 `Header` 代碼。例如 `[0, 233, 26, 92]` 即表示為「方法請求」的標頭 `0`。

必須去除標頭才能夠解析二進制內容，二進制內容是一個 JSON 陣列，依照標頭來決定該如何載入這個內容。

### 方法請求

當要送出一個請求到伺服器時，其 WebSocket 內容格式如下。

- 0：工作編號，用以對應本地後續異步的處理函式。
- 1：欲呼叫的遠端方法函式名稱。
- 2：中繼資料（如：請求發起元件名稱、客戶端版本號碼）。
- 3：主要資料內容。

```json
0,                                // Header

[0 0],                            // Task ID  Length
[0],                              // Function Length
[0 0],                            // Metadata Length

1,                                // Task ID
"CreateComment",                  // Function
{ "component": "CommentInput"  }  // Metadata
{ "content"  : "Hello, world!" }, // Data
```

### 回應內容

伺服器透過 WebSocket 所回傳的標準回應格式內容如下。

- 0：工作編號，用以對應客戶端的處理函式。
- 1：回應代號。
- 2：主要成功資料內容（與 `err` 欄位不會同時存在）。
- 3：錯誤資料（與 `dat` 欄位不會同時存在）。

```json
1                               // Header

[0 0],                          // Task ID     Length
[0],                            // Status Code Length

1,                              // Task ID
1,                              // Status Code
{ "id": 19 },                   // Data
null,                           // Error Data
```

### 通知內容

伺服器經由 WebSocket 主動發送至客戶端的通知事件內容格式如下。

- 0：事件名稱。
- 1：資料內容。

```json
2                              // Header

[0],                           // Event Length

"NewChatMessage",              // Event
{ "content": "Foo, bar!"    }, // Data
```

### 檔案上傳

由客戶端經過 WebSocket 上傳檔案的時候，是切分為區塊並且以二進制資料進行傳遞。

- 0：工作編號，用以對應客戶端的處理函式。
- 1：欲呼叫的遠端方法函式名稱。
- 2：檔案金鑰。
- 3：中繼資料（如：伺服器版本號碼、負載狀態）。
- 4：檔案名稱。
- 5：檔案總大小。
- 6：檔案二進制內容。

```json
3                                       // Header

[0 0],                                  // Task ID    Length
[0],                                    // Function   Length
[0 0],                                  // Metadata   Length
[0],                                    // Filename   Length (Once)
[0 0],                                  // Total Size Length (Once)

1,                                      // ID
"UploadFile",                           // Function
"22523e48-7769-4369-b8f5-89c58a7804ed", // Key      (Fixed 36 GUID)
{ "component": "CommentInput" },        // Metadata
"video.mp4"                             // Filename (Once)
138273214142,                           // Size
[128, 12, 83, 251, 90, 146],            // Binary
```

#### 區塊二進制格式

```bash
+-----------+-----------+-----------+-----------+------------+
| File Name | File Name | Extension | File Size |   Binary   |
+-----------+-----------+-----------+-----------+------------+
| 256 Bytes | 256 Bytes | 16  Bytes | 4   Bytes | 748  Bytes | = 1024 Bytes
+-----------+-----------+-----------+-----------+------------+
```

每個區塊被切分為 1024 KB（也就是 1 MB）。

```bash
+------------------------------------------------+
|                      Binary                    |
+------------------------------------------------+
|                    1024 Bytes                  |
+------------------------------------------------+
```

## 狀態代號

成功

| 狀態碼 | 狀態字樣   | 說明                                                       |
| ------ | ---------- | ---------------------------------------------------------- |
| 0      | OK         | 完全沒有錯誤                                               |
| 1      | YES        | 是                                                         |
| 2      | NO         | 否                                                         |
| 3      | PROCESSING | 已接收到請求且正在處理中，不會馬上完成                     |
| 4      | NO_CHANGES | 提出的請求沒有改變任何事情，例如：請求刪除已經被刪除的資料 |

錯誤

| 狀態碼 | 狀態字樣           | 說明                                                       |
| ------ | ------------------ | ---------------------------------------------------------- |
| 50     | ERROR              | 內部不可預期的錯誤                                         |
| 51     | FULL               | 已滿而無法接受該請求，例如：正在加入已滿的聊天室、朋友清單 |
| 52     | EXISTS             | 某個東西已經存在，例如：使用者名稱、電子郵件地址           |
| 53     | INVALID            | 請求的格式不正確                                           |
| 54     | NOT_FOUND          | 找不到請求的資源                                           |
| 55     | NOT_AUTHORIZED     | 請求者必須登入後才能發送此請求                             |
| 56     | NO_PERMISSION      | 請求者在登入後沒有權限發送此請求而被拒絕                   |
| 57     | UNIMPLEMENTED      | 此功能尚未被實作完成                                       |
| 58     | TOO_MANY_REQUESTS  | 請求者在短時間內有太多的請求，需要暫緩一會才能重新發送請求 |
| 59     | RESOURCE_EXHAUSTED | 請求者可用的請求額度已被耗盡                               |
| 60     | BUSY               | 伺服器正在繁忙中而暫時無法處理此請求                       |
| 61     | DEAD               | 伺服器已經關閉，可能是正在維護或是遇到錯誤而長期停機       |
